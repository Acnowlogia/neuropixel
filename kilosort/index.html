



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for neuropixel-utils">
      
      
      
        <meta name="author" content="Daniel J. O'Shea">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.2.0">
    
    
      
        <title>Running Kilosort - Neuropixel Utilities</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.572ca0f0.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#2196f3">
      
    
    
      <script src="../assets/javascripts/modernizr.8c900955.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#running-and-loading-kilosort-12-results" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Neuropixel Utilities" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Neuropixel Utilities
              </span>
              <span class="md-header-nav__topic">
                Running Kilosort
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/djoshea/neuropixel-utils/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      djoshea/neuropixel-utils
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Neuropixel Utilities" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Neuropixel Utilities
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/djoshea/neuropixel-utils/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      djoshea/neuropixel-utils
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../imec_dataset/" title="Neuropixel.ImecDataset" class="md-nav__link">
      Neuropixel.ImecDataset
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Running Kilosort
      </label>
    
    <a href="./" title="Running Kilosort" class="md-nav__link md-nav__link--active">
      Running Kilosort
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#running-kilosort" title="Running Kilosort" class="md-nav__link">
    Running Kilosort
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loading-kilosort-results" title="Loading Kilosort results" class="md-nav__link">
    Loading Kilosort results
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#segmenting-a-kilosort-dataset-into-trials" title="Segmenting a Kilosort dataset into trials" class="md-nav__link">
    Segmenting a Kilosort dataset into trials
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trialsegmentationinfo" title="TrialSegmentationInfo" class="md-nav__link">
    TrialSegmentationInfo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kilosorttrialsegmenteddataset" title="KiloSortTrialSegmentedDataset" class="md-nav__link">
    KiloSortTrialSegmentedDataset
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../analysis/" title="Analysis of Kilosort Results" class="md-nav__link">
      Analysis of Kilosort Results
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../waveforms/" title="Extracting Waveforms" class="md-nav__link">
      Extracting Waveforms
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../acknowledgements/" title="Acknowledgements and Support" class="md-nav__link">
      Acknowledgements and Support
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#running-kilosort" title="Running Kilosort" class="md-nav__link">
    Running Kilosort
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loading-kilosort-results" title="Loading Kilosort results" class="md-nav__link">
    Loading Kilosort results
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#segmenting-a-kilosort-dataset-into-trials" title="Segmenting a Kilosort dataset into trials" class="md-nav__link">
    Segmenting a Kilosort dataset into trials
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trialsegmentationinfo" title="TrialSegmentationInfo" class="md-nav__link">
    TrialSegmentationInfo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kilosorttrialsegmenteddataset" title="KiloSortTrialSegmentedDataset" class="md-nav__link">
    KiloSortTrialSegmentedDataset
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/djoshea/neuropixel-utils/edit/master/docs/kilosort.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="running-and-loading-kilosort-12-results">Running and loading KiloSort 1/2 results<a class="headerlink" href="#running-and-loading-kilosort-12-results" title="Permanent link">&para;</a></h1>
<p><code class="codehilite">KilosortDatset</code> is a wrapper around the output of Kilosort or Kilosort2, which will load the output files back into Matlab for further analysis. Most of these fields are explained in detail in the (Phy documentation)[https://phy-contrib.readthedocs.io/en/latest/template-gui/] but we document them here for convenience.</p>
<h2 id="running-kilosort">Running Kilosort<a class="headerlink" href="#running-kilosort" title="Permanent link">&para;</a></h2>
<p>To run Kilosort or Kilosort2 on an ImecDataset:</p>
<div class="codehilite"><pre><span></span><span class="n">Neuropixel</span><span class="p">.</span><span class="n">runKilosort1</span><span class="p">(</span><span class="n">imec</span><span class="p">,</span> <span class="c">...);</span>
<span class="n">Neuropixel</span><span class="p">.</span><span class="n">runKiloSort2</span><span class="p">(</span><span class="n">imec</span><span class="p">,</span> <span class="c">...);</span>
</pre></div>

<p>By default, the standard configuration settings will be used. For Kilosort1, these are hardcoded based on <code class="codehilite">configFiles/StandardConfig_MOVEME.m</code>. For Kilosort2, the script <code class="codehilite">configFiles/configFile384.m</code> will be run to produce the <code class="codehilite">ops</code> struct, unless a different configuration file is set in the environment variable <code class="codehilite">KILOSORT_CONFIG_FILE</code>, which must be on the path. Default configuration settings can be overridden by passing in extra parameters, e.g.</p>
<div class="codehilite"><pre><span></span><span class="n">Neuropixel</span><span class="p">.</span><span class="n">runKiloSort1</span><span class="p">(</span><span class="n">imec</span><span class="p">,</span> <span class="s">&#39;Th&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">10</span><span class="p">],</span> <span class="s">&#39;GPU&#39;</span><span class="p">,</span> <span class="n">false</span><span class="p">);</span>
<span class="n">Neuropixel</span><span class="p">.</span><span class="n">runKilosort2</span><span class="p">(</span><span class="n">imec</span><span class="p">,</span> <span class="s">&#39;minfr_goodchannels&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">);</span>
</pre></div>

<h2 id="loading-kilosort-results">Loading Kilosort results<a class="headerlink" href="#loading-kilosort-results" title="Permanent link">&para;</a></h2>
<p>You can create a KilosortDataset instance by pointing at the folder containing the Kilosort output:</p>
<div class="codehilite"><pre><span></span><span class="n">ks</span> <span class="p">=</span> <span class="n">Neuropixel</span><span class="p">.</span><span class="n">KilosortDataset</span><span class="p">(</span><span class="n">pathToKilosortOutput</span><span class="p">();</span>
<span class="n">ks</span><span class="p">.</span><span class="n">load</span><span class="p">();</span>
</pre></div>

<p>The constructor will optionally take an &lsquo;imecDataset&rsquo; parameter providing the <code class="codehilite">Neuropixel.ImecDataset&#39; instance if there is no</code>.imec.ap.bin<code class="codehilite">file in the Kilosort directory, and a &#39;channelMap&#39; parameter in case the default is not correct. The results can then be loaded using</code>ks.load()`.</p>
<p>The descriptions of each property can be found in the <code class="codehilite">+Neuropixel/KiloSortDataset.m</code> code, copied here for convenience, originally described in the (Phy documentation)[https://phy-contrib.readthedocs.io/en/latest/template-gui/]:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">ks</span>

<span class="n">KiloSortDataset</span> <span class="n">with</span> <span class="k">properties</span><span class="p">:</span>

                  <span class="n">path</span><span class="p">:</span> <span class="s">&#39;/data/kilosort/neuropixel_01&#39;</span>
           <span class="n">raw_dataset</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span>×<span class="mi">1</span> <span class="n">Neuropixel</span><span class="p">.</span><span class="n">ImecDataset</span><span class="p">]</span>
            <span class="n">channelMap</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span>×<span class="mi">1</span> <span class="n">Neuropixel</span><span class="p">.</span><span class="n">ChannelMap</span><span class="p">]</span>
                  <span class="n">fsAP</span><span class="p">:</span> <span class="mi">30000</span>
           <span class="n">apScaleToUv</span><span class="p">:</span> <span class="mf">2.3438</span>
                  <span class="n">meta</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span>×<span class="mi">1</span> <span class="n">struct</span><span class="p">]</span>
              <span class="n">pathLeaf</span><span class="p">:</span> <span class="s">&#39;neuropixel_01&#39;</span>
              <span class="n">isLoaded</span><span class="p">:</span> <span class="mi">1</span>
         <span class="n">hasRawDataset</span><span class="p">:</span> <span class="mi">1</span>
             <span class="n">nChannels</span><span class="p">:</span> <span class="mi">371</span>
               <span class="n">nSpikes</span><span class="p">:</span> <span class="mi">8181228</span>
             <span class="n">nClusters</span><span class="p">:</span> <span class="mi">592</span>
            <span class="n">nTemplates</span><span class="p">:</span> <span class="mi">653</span>
           <span class="n">nPCFeatures</span><span class="p">:</span> <span class="mi">32</span>
   <span class="n">nFeaturesPerChannel</span><span class="p">:</span> <span class="mi">3</span>
          <span class="n">syncBitNames</span><span class="p">:</span> <span class="p">[</span><span class="mi">16</span>×<span class="mi">1</span> <span class="n">string</span><span class="p">]</span>
              <span class="n">dat_path</span><span class="p">:</span> <span class="s">&#39;neuropixel_01.imec.ap.bin&#39;</span>
        <span class="n">n_channels_dat</span><span class="p">:</span> <span class="mi">385</span>
                 <span class="n">dtype</span><span class="p">:</span> <span class="s">&#39;int16&#39;</span>
                <span class="n">offset</span><span class="p">:</span> <span class="mi">0</span>
           <span class="n">sample_rate</span><span class="p">:</span> <span class="mi">30000</span>
           <span class="n">hp_filtered</span><span class="p">:</span> <span class="mi">0</span>
            <span class="n">amplitudes</span><span class="p">:</span> <span class="p">[</span><span class="n">nSpikes</span> × <span class="mi">1</span> <span class="n">double</span><span class="p">]</span>
           <span class="n">channel_ids</span><span class="p">:</span> <span class="p">[</span><span class="n">nChannels</span> × <span class="mi">1</span> <span class="n">uint32</span><span class="p">]</span>
     <span class="n">channel_positions</span><span class="p">:</span> <span class="p">[</span><span class="n">nChannels</span> × <span class="mi">2</span> <span class="n">double</span><span class="p">]</span>
           <span class="n">pc_features</span><span class="p">:</span> <span class="p">[</span><span class="n">nSpikes</span> × <span class="n">nFeaturesPerChannel</span> × <span class="n">nPCFeatures</span> <span class="n">single</span><span class="p">]</span>
        <span class="n">pc_feature_ind</span><span class="p">:</span> <span class="p">[</span><span class="n">nTemplates</span> × <span class="n">nPCFeatures</span> <span class="n">uint32</span><span class="p">]</span>
     <span class="n">similar_templates</span><span class="p">:</span> <span class="p">[</span><span class="n">nTemplates</span> × <span class="n">nTemplates</span> <span class="n">single</span><span class="p">]</span>
       <span class="n">spike_templates</span><span class="p">:</span> <span class="p">[</span><span class="n">nSpikes</span> × <span class="mi">1</span> <span class="n">uint32</span><span class="p">]</span>
           <span class="n">spike_times</span><span class="p">:</span> <span class="p">[</span><span class="n">nSpikes</span> × <span class="mi">1</span> <span class="n">uint64</span><span class="p">]</span>
     <span class="n">template_features</span><span class="p">:</span> <span class="p">[</span><span class="n">nSpikes</span> × <span class="n">nPCFeatures</span> <span class="n">single</span><span class="p">]</span>
  <span class="n">template_feature_ind</span><span class="p">:</span> <span class="p">[</span><span class="n">nTemplates</span> × <span class="n">nPCFeatures</span> <span class="n">uint32</span><span class="p">]</span>
             <span class="n">templates</span><span class="p">:</span> <span class="p">[</span><span class="n">nTemplates</span> × <span class="n">nTimePoints</span> × <span class="n">nChannels</span> <span class="n">single</span><span class="p">]</span>
         <span class="n">templates_ind</span><span class="p">:</span> <span class="p">[</span><span class="n">nTemplates</span> × <span class="n">nChannels</span> <span class="n">double</span><span class="p">]</span>
         <span class="n">whitening_mat</span><span class="p">:</span> <span class="p">[</span><span class="n">nChannels</span> × <span class="n">nChannels</span> <span class="n">double</span><span class="p">]</span>
     <span class="n">whitening_mat_inv</span><span class="p">:</span> <span class="p">[</span><span class="n">nChannels</span> × <span class="n">nChannels</span> <span class="n">double</span><span class="p">]</span>
        <span class="n">spike_clusters</span><span class="p">:</span> <span class="p">[</span><span class="n">nSpikes</span> × <span class="mi">1</span> <span class="n">uint32</span><span class="p">]</span>
        <span class="n">cluster_groups</span><span class="p">:</span> <span class="p">[</span><span class="n">nClusters</span> × <span class="mi">1</span> <span class="n">categorical</span><span class="p">]</span>
           <span class="n">cluster_ids</span><span class="p">:</span> <span class="p">[</span><span class="n">nClusters</span> × <span class="mi">1</span> <span class="n">uint32</span><span class="p">]</span>
         <span class="n">clusters_good</span><span class="p">:</span> <span class="p">[</span><span class="n">nClustersGood</span> × <span class="mi">1</span> <span class="n">uint32</span><span class="p">]</span>
          <span class="n">clusters_mua</span><span class="p">:</span> <span class="p">[</span><span class="n">nClustersMUA</span> × <span class="mi">1</span> <span class="n">uint32</span><span class="p">]</span>
        <span class="n">clusters_noise</span><span class="p">:</span> <span class="p">[</span><span class="n">nClustersNoise</span> × <span class="mi">1</span> <span class="n">uint32</span><span class="p">]</span>
     <span class="n">clusters_unsorted</span><span class="p">:</span> <span class="p">[</span><span class="n">nClustersUnsorted</span> × <span class="mi">1</span> <span class="n">uint32</span><span class="p">]</span>
</pre></div>

<ul>
<li>
<p><code class="codehilite">nChannels</code> : number of channels used by Kilosort</p>
</li>
<li>
<p><code class="codehilite">nSpikes</code> : number of spikes extracted</p>
</li>
<li>
<p><code class="codehilite">nClusters</code> : number of unique clusters</p>
</li>
<li>
<p><code class="codehilite">nTemplates</code> : number of spike templates</p>
</li>
<li>
<p><code class="codehilite">nPCFeatures</code> number of spatiotemporal PC features used for templates</p>
</li>
<li>
<p><code class="codehilite">nFeaturesPerChannel</code> : number of PC features used for each channel</p>
</li>
<li>
<p><code class="codehilite">amplitudes</code> - [nSpikes] double vector with the amplitude scaling factor that was applied to the template when extracting that spike</p>
</li>
<li>
<p><code class="codehilite">channel_ids</code> - [nChannels] uint32 vector with the channel ids used for sorting</p>
</li>
<li>
<p><code class="codehilite">channel_positions</code> - [nChannels, 2] double matrix with each row giving the x and y coordinates of that channel. Together with the channel map, this determines how waveforms will be plotted in WaveformView (see below).</p>
</li>
<li>
<p><code class="codehilite">pc_features</code> - [nSpikes, nFeaturesPerChannel, nPCFeatures] single matrix giving the PC values for each spike. The channels that those features came from are specified in pc_features_ind. E.g. the value at pc_features[123, 1, 5] is the projection of the 123rd spike onto the 1st PC on the channel given by pc_feature_ind[5].</p>
</li>
<li>
<p><code class="codehilite">pc_feature_ind</code> - [nTemplates, nPCFeatures] uint32 matrix specifying which channels contribute to each entry in dim 3 of the pc_features matrix</p>
</li>
<li>
<p><code class="codehilite">similar_templates</code> - [nTemplates, nTemplates] single matrix giving the similarity score (larger is more similar) between each pair of templates
similar_templates(:, :) single</p>
</li>
<li>
<p><code class="codehilite">spike_templates</code> - [nSpikes] uint32 vector specifying the identity of the template that was used to extract each spike</p>
</li>
<li>
<p><code class="codehilite">spike_times</code> - [nSpikes] uint64 vector giving the spike time of each spike in samples. To convert to seconds, divide by sample_rate from params.py.</p>
</li>
<li>
<p><code class="codehilite">template_features</code> - [nSpikes, nTempFeatures] single matrix giving the magnitude of the projection of each spike onto nTempFeatures other features. Which other features is specified in template_feature_ind</p>
</li>
<li>
<p><code class="codehilite">template_feature_ind</code> - [nTemplates, nTempFeatures] uint32 matrix specifying which templateFeatures are included in the template_features matrix.</p>
</li>
<li>
<p><code class="codehilite">templates</code> - [nTemplates, nTimePoints, nTemplateChannels] single matrix giving the template shapes on the channels given in templates_ind</p>
</li>
<li>
<p><code class="codehilite">templates_ind</code> - [nTemplates, nTempChannels] double matrix specifying the channels on which each template is defined. In the case of Kilosort templates_ind is just the integers from 0 to nChannels-1, since templates are defined on all channels.</p>
</li>
<li>
<p><code class="codehilite">whitening_mat</code> - [nChannels, nChannels] double whitening matrix applied to the data during automatic spike sorting</p>
</li>
<li>
<p><code class="codehilite">whitening_mat_inv</code> - [nChannels, nChannels] double, the inverse of the whitening matrix.</p>
</li>
<li>
<p><code class="codehilite">spike_clusters</code> - [nSpikes] uint32 vector giving the cluster identity of each spike.</p>
</li>
<li>
<p><code class="codehilite">cluster_groups</code> - [nClusters] categorical vector giving the &ldquo;cluster group&rdquo; of each cluster (noise, mua, good, unsorted)</p>
</li>
<li>
<p><code class="codehilite">cluster_ids</code> - unique clusters in spike_clusters [nClusters]</p>
</li>
</ul>
<h2 id="segmenting-a-kilosort-dataset-into-trials">Segmenting a Kilosort dataset into trials<a class="headerlink" href="#segmenting-a-kilosort-dataset-into-trials" title="Permanent link">&para;</a></h2>
<p><code class="codehilite">ks.spike_times</code> contains the times for each spike in samples from the beginning of the file, but there is a more useful representation for data collected with a trial structure: split the spikes into separate groups based on which trial they occurred in, and convert the times to milliseconds since the start of the trial.</p>
<h3 id="trialsegmentationinfo">TrialSegmentationInfo<a class="headerlink" href="#trialsegmentationinfo" title="Permanent link">&para;</a></h3>
<p>In order to do this, you need to figure out where trials start and stop. You&rsquo;ll need to write this code, since this will differ for each experimental setup. Essentially, you need to create a <code class="codehilite">Neuropixel.TrialSegmentationInfo</code> instance and populate its fields with the correct values:</p>
<div class="codehilite"><pre><span></span><span class="n">tsi</span> <span class="p">=</span> <span class="n">Neuropixel</span><span class="p">.</span><span class="n">TrialSegmentationInfo</span><span class="p">(</span><span class="n">nTrials</span><span class="p">,</span> <span class="n">fsAP</span><span class="p">);</span>
<span class="n">tsi</span><span class="p">.</span><span class="n">idxStart</span> <span class="p">=</span> <span class="p">[</span><span class="n">list</span> <span class="n">of</span> <span class="n">start</span> <span class="n">sample</span> <span class="n">indices</span><span class="p">]</span>
<span class="n">tsi</span><span class="p">.</span><span class="n">idxStop</span> <span class="p">=</span> <span class="p">[</span><span class="n">list</span> <span class="n">of</span> <span class="n">stop</span> <span class="n">sample</span> <span class="n">indices</span><span class="p">];</span>
<span class="n">tsi</span><span class="p">.</span><span class="n">trialId</span> <span class="p">=</span> <span class="p">[</span><span class="n">list</span> <span class="n">of</span> <span class="n">trial</span> <span class="n">ids</span><span class="p">];</span>
</pre></div>

<p>Here is an example script that uses the sync channel to determine where trials begin and end. It expects one bit (named <code class="codehilite">&#39;trialStart&#39;</code>) to contain TTL pulses each time a trial starts, and another bit (named <code class="codehilite">&#39;trialInfo&#39;</code>) to contain ASCII-serialized bits of text occurring at the start of each trial. For example, the string <code class="codehilite">id=1;c=2</code> would correspond to <code class="codehilite">trialId=1</code> and <code class="codehilite">conditionId=2</code>. It also assumes that a trial ends when the next trial begins (or at the end of the file). Long trials can be subsequently truncated using <code class="codehilite">tsi.truncateTrialsLongerThan(maxDurationSeconds)</code>.</p>
<div class="codehilite"><pre><span></span><span class="k">function</span><span class="w"> </span>tsi <span class="p">=</span><span class="w"> </span><span class="nf">parseTrialInfoFromSync</span><span class="p">(</span>syncRaw, fs, syncBitNames<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="c">% fs is in samples per second</span>
    <span class="c">% parses the sync line of an neuropixel .imec.ap.bin data file</span>
    <span class="c">% and produces a scalar TrialSegmentationInfo</span>

    <span class="c">% parse the sync</span>
    <span class="k">if</span> <span class="nb">isempty</span><span class="p">(</span><span class="n">syncBitNames</span><span class="p">)</span>
        <span class="n">trialInfoBitNum</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">trialStartBitNum</span> <span class="p">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">else</span>
        <span class="p">[</span><span class="n">tf</span><span class="p">,</span> <span class="n">trialInfoBitNum</span><span class="p">]</span> <span class="p">=</span> <span class="n">ismember</span><span class="p">(</span><span class="s">&#39;trialInfo&#39;</span><span class="p">,</span> <span class="n">syncBitNames</span><span class="p">);</span>
        <span class="k">if</span> <span class="o">~</span><span class="n">tf</span><span class="p">,</span> <span class="n">trialInfoBitNum</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span> <span class="k">end</span>
        <span class="p">[</span><span class="n">tf</span><span class="p">,</span> <span class="n">trialStartBitNum</span><span class="p">]</span> <span class="p">=</span> <span class="n">ismember</span><span class="p">(</span><span class="s">&#39;trialStart&#39;</span><span class="p">,</span> <span class="n">syncBitNames</span><span class="p">);</span>
        <span class="k">if</span> <span class="o">~</span><span class="n">tf</span><span class="p">,</span> <span class="n">trialStartBitNum</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span> <span class="k">end</span>
    <span class="k">end</span>

    <span class="n">serialBit</span> <span class="p">=</span> <span class="n">bitget</span><span class="p">(</span><span class="n">syncRaw</span><span class="p">,</span> <span class="n">trialInfoBitNum</span><span class="p">);</span>
    <span class="n">trialStart</span> <span class="p">=</span> <span class="n">bitget</span><span class="p">(</span><span class="n">syncRaw</span><span class="p">,</span> <span class="n">trialStartBitNum</span><span class="p">);</span>

    <span class="c">% trials start when going high</span>
    <span class="n">idxStart</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">diff</span><span class="p">(</span><span class="n">trialStart</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">nTrials</span> <span class="p">=</span> <span class="nb">numel</span><span class="p">(</span><span class="n">idxStart</span><span class="p">);</span>

    <span class="n">tsi</span> <span class="p">=</span> <span class="n">Neuropixel</span><span class="p">.</span><span class="n">TrialSegmentationInfo</span><span class="p">(</span><span class="n">nTrials</span><span class="p">,</span> <span class="n">fs</span><span class="p">);</span>

    <span class="n">samplesEachBit</span> <span class="p">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">fs</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">);</span> <span class="c">% each bit delivered per ms</span>
    <span class="k">for</span> <span class="n">iR</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">nTrials</span>
        <span class="k">if</span> <span class="n">iR</span> <span class="o">&lt;</span> <span class="n">nTrials</span>
            <span class="n">idxNext</span> <span class="p">=</span> <span class="n">idxStart</span><span class="p">(</span><span class="n">iR</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="n">idxNext</span> <span class="p">=</span> <span class="nb">numel</span><span class="p">(</span><span class="n">serialBit</span><span class="p">);</span>
        <span class="k">end</span>
        <span class="n">bitsByTrial</span> <span class="p">=</span> <span class="n">uint8</span><span class="p">(</span><span class="n">serialBit</span><span class="p">(</span><span class="nb">floor</span><span class="p">(</span><span class="n">samplesEachBit</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">idxStart</span><span class="p">(</span><span class="n">iR</span><span class="p">)</span> <span class="p">:</span> <span class="n">samplesEachBit</span> <span class="p">:</span> <span class="n">idxNext</span><span class="p">));</span>

        <span class="n">lastHigh</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">bitsByTrial</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;last&#39;</span><span class="p">);</span>
        <span class="n">lastHigh</span> <span class="p">=</span> <span class="nb">ceil</span><span class="p">(</span><span class="n">lastHigh</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span><span class="p">;</span>
        <span class="n">bitsByTrial</span> <span class="p">=</span> <span class="n">bitsByTrial</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lastHigh</span><span class="p">);</span>

        <span class="n">infoThis</span> <span class="p">=</span> <span class="n">parseInfoString</span><span class="p">(</span><span class="n">bitsToString</span><span class="p">(</span><span class="n">bitsByTrial</span><span class="p">));</span>

        <span class="k">if</span> <span class="n">isfield</span><span class="p">(</span><span class="n">infoThis</span><span class="p">,</span> <span class="s">&#39;id&#39;</span><span class="p">)</span>
            <span class="n">tsi</span><span class="p">.</span><span class="n">trialId</span><span class="p">(</span><span class="n">iR</span><span class="p">)</span> <span class="p">=</span> <span class="n">str2double</span><span class="p">(</span><span class="n">infoThis</span><span class="p">.</span><span class="n">id</span><span class="p">);</span> <span class="c">%#ok&lt;*AGROW&gt;</span>
        <span class="k">else</span>
            <span class="n">tsi</span><span class="p">.</span><span class="n">trialId</span><span class="p">(</span><span class="n">iR</span><span class="p">)</span> <span class="p">=</span> <span class="n">NaN</span><span class="p">;</span>
        <span class="k">end</span>
        <span class="k">if</span> <span class="n">isfield</span><span class="p">(</span><span class="n">infoThis</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">)</span>
            <span class="n">tsi</span><span class="p">.</span><span class="n">conditionId</span><span class="p">(</span><span class="n">iR</span><span class="p">)</span> <span class="p">=</span> <span class="n">str2double</span><span class="p">(</span><span class="n">infoThis</span><span class="p">.</span><span class="n">c</span><span class="p">);</span>
        <span class="k">else</span>
            <span class="n">tsi</span><span class="p">.</span><span class="n">conditionId</span><span class="p">(</span><span class="n">iR</span><span class="p">)</span> <span class="p">=</span> <span class="n">NaN</span><span class="p">;</span>
        <span class="k">end</span>

        <span class="n">tsi</span><span class="p">.</span><span class="n">idxStart</span><span class="p">(</span><span class="n">iR</span><span class="p">)</span> <span class="p">=</span> <span class="n">idxStart</span><span class="p">(</span><span class="n">iR</span><span class="p">);</span>
        <span class="n">tsi</span><span class="p">.</span><span class="n">idxStop</span><span class="p">(</span><span class="n">iR</span><span class="p">)</span> <span class="p">=</span> <span class="n">idxNext</span><span class="p">;</span>
    <span class="k">end</span>

<span class="k">    function</span><span class="w"> </span>out <span class="p">=</span><span class="w"> </span><span class="nf">bitsToString</span><span class="p">(</span>bits<span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">nChar</span> <span class="p">=</span> <span class="nb">numel</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span><span class="p">;</span>
        <span class="n">assert</span><span class="p">(</span><span class="n">nChar</span> <span class="o">==</span> <span class="nb">round</span><span class="p">(</span><span class="n">nChar</span><span class="p">),</span> <span class="s">&#39;Bit length must be multiple of 8&#39;</span><span class="p">);</span>
        <span class="n">out</span> <span class="p">=</span> <span class="n">blanks</span><span class="p">(</span><span class="n">nChar</span><span class="p">);</span>
        <span class="k">for</span> <span class="n">iC</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">nChar</span>
            <span class="n">idx</span> <span class="p">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">iC</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">;</span>
            <span class="n">out</span><span class="p">(</span><span class="n">iC</span><span class="p">)</span>  <span class="p">=</span> <span class="n">char</span><span class="p">(</span><span class="n">bin2dec</span><span class="p">(</span><span class="n">sprintf</span><span class="p">(</span><span class="s">&#39;%u&#39;</span><span class="p">,</span> <span class="n">bits</span><span class="p">(</span><span class="n">idx</span><span class="p">))));</span>
        <span class="k">end</span>
    <span class="k">end</span>

<span class="k">    function</span><span class="w"> </span>out <span class="p">=</span><span class="w"> </span><span class="nf">parseInfoString</span><span class="p">(</span>str<span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">keyval</span> <span class="p">=</span> <span class="n">regexp</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="s">&#39;(?&lt;key&gt;\w+)=(?&lt;value&gt;[\d\.]+)&#39;</span><span class="p">,</span> <span class="s">&#39;names&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="nb">isempty</span><span class="p">(</span><span class="n">keyval</span><span class="p">)</span>
            <span class="n">warning</span><span class="p">(</span><span class="s">&#39;Could not parse info string &quot;%s&quot;&#39;</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>
            <span class="n">out</span> <span class="p">=</span> <span class="n">struct</span><span class="p">();</span>
        <span class="k">else</span>
            <span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">numel</span><span class="p">(</span><span class="n">keyval</span><span class="p">)</span>
                <span class="n">out</span><span class="p">.(</span><span class="n">keyval</span><span class="p">(</span><span class="nb">i</span><span class="p">).</span><span class="n">key</span><span class="p">)</span> <span class="p">=</span> <span class="n">keyval</span><span class="p">(</span><span class="nb">i</span><span class="p">).</span><span class="n">value</span><span class="p">;</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<h3 id="kilosorttrialsegmenteddataset">KiloSortTrialSegmentedDataset<a class="headerlink" href="#kilosorttrialsegmenteddataset" title="Permanent link">&para;</a></h3>
<p>Once you have the trial boundaries stored in your <code class="codehilite">TrialSegmentationInfo</code> instance, you can split the properties of the <code class="codehilite">KilosortDataset</code> into each trial, resulting in a <code class="codehilite">Neuropixel.KiloSortTrialSegmentedDataset</code> instance. To facilitate merging this into another data structure later, you will need to specify the ultimate <code class="codehilite">trialId</code> order you want the <code class="codehilite">KiloSortTrialSegmentedDataset</code> to have. For example, if you have a behavioral data structure, you can extract the list of trial ids from that so that your <code class="codehilite">KiloSortTrialSegmentedDataset</code> will have a matching trial sequence.</p>
<div class="codehilite"><pre><span></span><span class="n">trialIds</span> <span class="p">=</span> <span class="nb">cat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">behaviorStruct</span><span class="p">.</span><span class="n">trialId</span><span class="p">);</span>
</pre></div>

<p>Any trials not found in the <code class="codehilite">TrialSegmentationInfo</code> will simply be empty in the <code class="codehilite">KiloSortTrialSegmentedDataset</code>. If you simply want to preserve the trials in the order they are in <code class="codehilite">tsi</code>, you can simply use:</p>
<div class="codehilite"><pre><span></span><span class="n">trialIds</span> <span class="p">=</span> <span class="n">tsi</span><span class="p">.</span><span class="n">trialIds</span><span class="p">;</span>
</pre></div>

<p>You can then segment the KiloSortDataset using:</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">seg</span> <span class="p">=</span> <span class="n">Neuropixel</span><span class="p">.</span><span class="n">KiloSortTrialSegmentedDataset</span><span class="p">(</span><span class="n">ks</span><span class="p">,</span> <span class="n">tsi</span><span class="p">,</span> <span class="n">trial_ids</span><span class="p">)</span>

<span class="n">KiloSortTrialSegmentedDataset</span> <span class="n">with</span> <span class="k">properties</span><span class="p">:</span>

                   <span class="n">dataset</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span>×<span class="mi">1</span> <span class="n">Neuropixel</span><span class="p">.</span><span class="n">KiloSortDataset</span><span class="p">]</span> <span class="c">% unsegmented KilosortDataset</span>
                 <span class="n">trial_ids</span><span class="p">:</span> <span class="p">[</span><span class="n">nTrials</span> × <span class="mi">1</span> <span class="n">uint32</span><span class="p">]</span> <span class="c">% trial ids</span>
            <span class="n">trial_has_data</span><span class="p">:</span> <span class="p">[</span><span class="n">nTrials</span> × <span class="mi">1</span> <span class="n">logical</span><span class="p">]</span> <span class="c">% indicator if trial found in tsi</span>
               <span class="n">trial_start</span><span class="p">:</span> <span class="p">[</span><span class="n">nTrials</span> × <span class="mi">1</span> <span class="n">uint64</span><span class="p">]</span> <span class="c">% nTrials start sample idx copied from tsi</span>
                <span class="n">trial_stop</span><span class="p">:</span> <span class="p">[</span><span class="n">nTrials</span> × <span class="mi">1</span> <span class="n">uint64</span><span class="p">]</span> <span class="c">% nTrials start sample idx copied from tsi</span>
                 <span class="n">spike_idx</span><span class="p">:</span> <span class="p">{</span><span class="n">nTrials</span> × <span class="n">nClusters</span> <span class="n">cell</span><span class="p">}</span> <span class="c">% nTrials x nClusters lists of indices into ks.spike_times array for each spike</span>
               <span class="n">cluster_ids</span><span class="p">:</span> <span class="p">[</span><span class="n">nClusters</span> × <span class="mi">1</span> <span class="n">uint32</span><span class="p">]</span> <span class="c">% copied from ks</span>
            <span class="n">cluster_groups</span><span class="p">:</span> <span class="p">[</span><span class="n">nClusters</span> × <span class="mi">1</span> <span class="n">categorical</span><span class="p">]</span> <span class="c">% copied from ks</span>
                      <span class="n">sync</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span>×<span class="mi">1</span> <span class="n">cell</span><span class="p">}</span> <span class="c">%  segmented contents of sync channel</span>
              <span class="n">syncBitNames</span><span class="p">:</span> <span class="p">[</span><span class="mi">16</span>×<span class="mi">1</span> <span class="n">string</span><span class="p">]</span> <span class="c">% copied from ImecDataset</span>
               <span class="n">raw_dataset</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span>×<span class="mi">1</span> <span class="n">Neuropixel</span><span class="p">.</span><span class="n">ImecDataset</span><span class="p">]</span> <span class="c">% original ImecDataset copied from ks</span>
                   <span class="n">nTrials</span><span class="p">:</span> <span class="mi">1092</span> <span class="c">% number of trials as numel(trialIds)</span>
           <span class="n">nTrialsHaveData</span><span class="p">:</span> <span class="mi">1092</span> <span class="c">% number of trials with matching trialIds in tsi</span>
                 <span class="n">nClusters</span><span class="p">:</span> <span class="mi">592</span> <span class="c">% number of clusters (sorted units)</span>
           <span class="n">nChannelsSorted</span><span class="p">:</span> <span class="mi">385</span> <span class="c">% number of channels</span>
               <span class="n">channel_ids</span><span class="p">:</span> <span class="p">[</span><span class="n">nChannelsSorted</span> × <span class="mi">1</span> <span class="n">unit32</span><span class="p">]</span> <span class="c">% list of channel ids used for sorting</span>
         <span class="n">trial_duration_ms</span><span class="p">:</span> <span class="p">[</span><span class="n">nTrials</span> × <span class="mi">1</span> <span class="n">double</span><span class="p">]</span>
                      <span class="n">fsAP</span><span class="p">:</span> <span class="mi">30000</span>
                <span class="n">amplitudes</span><span class="p">:</span> <span class="p">{</span><span class="n">nTrials</span> × <span class="n">nClusters</span> <span class="n">cell</span><span class="p">}</span> <span class="c">% each of these will contain a vector with one entry for each spike from that cluster on that trial</span>
               <span class="n">pc_features</span><span class="p">:</span> <span class="p">{</span><span class="n">nTrials</span> × <span class="n">nClusters</span> <span class="n">cell</span><span class="p">}</span>
               <span class="n">spike_times</span><span class="p">:</span> <span class="p">{</span><span class="n">nTrials</span> × <span class="n">nClusters</span> <span class="n">cell</span><span class="p">}</span> <span class="c">% raw sample times from ks</span>
  <span class="n">spike_times_ms_rel_start</span><span class="p">:</span> <span class="p">{</span><span class="n">nTrials</span> × <span class="n">nClusters</span> <span class="n">cell</span><span class="p">}</span> <span class="c">% times from trial start in milliseconds</span>
         <span class="n">template_features</span><span class="p">:</span> <span class="p">{</span><span class="n">nTrials</span> × <span class="n">nClusters</span> <span class="n">cell</span><span class="p">}</span>
           <span class="n">spike_templates</span><span class="p">:</span> <span class="p">{</span><span class="n">nTrials</span> × <span class="n">nClusters</span> <span class="n">cell</span><span class="p">}</span>
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../imec_dataset/" title="Neuropixel.ImecDataset" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Neuropixel.ImecDataset
              </span>
            </div>
          </a>
        
        
          <a href="../analysis/" title="Analysis of Kilosort Results" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Analysis of Kilosort Results
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 &mdash; <a href="http://djoshea.com">Daniel J. O&#39;Shea</a>
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/djoshea" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/djoshea" class="md-footer-social__link fa fa-twitter"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b41f3d20.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-322693-7"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-322693-7');
</script>

  </body>
</html>